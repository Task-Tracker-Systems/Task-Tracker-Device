<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Task Tracker: DR003 Test Granularity and Stubbing Challenges</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Task Tracker
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.xhtml');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">DR003 Test Granularity and Stubbing Challenges </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_doc_decisions_dr_003"></a> </p>
<h1><a class="anchor" id="autotoc_md28"></a>
Context</h1>
<p >Our software development project encounters challenges in designing unit tests due to issues with test granularity and stubbing dependencies.</p>
<p >Note that we structure our software into packages (see <a class="el" href="md_doc_software_architecture.xhtml#plugin_architecture">Implementing a Plug-in Architecture</a>) which are technically implemented as <a href="https://docs.platformio.org/en/latest/projectconf/sections/platformio/options/directory/lib_dir.html#lib-dir" title="documentation of `lib_dir`">(private) libraries</a> (see <a class="el" href="dr_002.xhtml">Root Directory for the Package's source files</a> ).</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Challenges with Stubbing</h1>
<p >Our initial assumption was to write unit tests for individual units. However, challenges arose, particularly regarding the granularity of "unit" tests envisioned.</p>
<h2><a class="anchor" id="dr_003_o0"></a>
Option 0: Testing individual units</h2>
<p >A unit in this context is, for example, a class or a translation unit. A test would be compiled along with the unit under test (UUT), linked together, and executed. The build configuration should be defined within the <a href="https://docs.platformio.org/en/latest/projectconf/#platformio-ini-project-configuration-file"><code>platformio.ini</code> configuration file</a>.</p>
<p >A limitation of PlatformIO <a href="https://community.platformio.org/t/partial-compilation-of-private-libraries-components-while-testing-for-different-environments/37079" title="Partial compilation of private libraries/components (while testing) for different environments">has been experienced</a> specifically with test builds, where not only the UUT but the whole library in which it resides is included in the build (see <a href="https://github.com/platformio/platformio-core/issues/4849" title="Library Dependency Finder (LDF) adds too many files when testing (pio test)">issue #4849</a>). This prevents stubbing dependencies of the UUT to other translation units within the same library, making it impossible to test individual units isolated from others this way.</p>
<h2><a class="anchor" id="dr_003_o1"></a>
Option 1: Filter source files</h2>
<p >To overcome the limitations from <a class="el" href="dr_003.xhtml#dr_003_o0">option 0</a>, one can use a <a href="https://docs.platformio.org/en/latest/manifests/library-json/index.html" title="PlatformIO documentation of manifest file"><code>library.json</code></a> manifest file for each library in combination with the <a href="https://docs.platformio.org/en/latest/manifests/library-json/fields/build/extrascript.html" title="documentation of `extraScript`"><code>extraScript</code> option</a> to filter files. This way, individual files could be filtered for specific build targets, although this approach is expected to be effortful, as filters have to be implemented for each individual unit.</p>
<h2><a class="anchor" id="dr_003_o2"></a>
Option 2: Split units into separate libraries</h2>
<p >Another way to circumvent the limitations from <a class="el" href="dr_003.xhtml#dr_003_o0">option 0</a> would be to separate each unit into an individual library. This way, only the UUT would be added to the test script for the test build. However, a major disadvantage would be that the planned structuring of the software packages into directories would be lost, making the analysis of the software structure more difficult.</p>
<h2><a class="anchor" id="dr_003_o3"></a>
Option 3: Test integrated units</h2>
<p >Test features using units and their dependencies to a certain degree:</p>
<p >Either include (using <a href="https://docs.platformio.org/en/latest/projectconf/sections/env/options/library/lib_deps.html" title="documentation of `lib_deps`"><code>lib_deps</code></a> in <a href="https://docs.platformio.org/en/latest/projectconf/#platformio-ini-project-configuration-file">the project configuration</a>):</p>
<ul>
<li><b>Option 3a):</b> all dependencies compatible with the test environment</li>
<li><b>Option 3b):</b> all dependencies compatible with the test environment, but no <a class="el" href="third_party_adapters.xhtml">3rd party library adapters</a></li>
<li><b>Option 3c):</b> only those dependencies which inevitably come as part of the library in which the UUT resides</li>
</ul>
<p >Omitted dependencies need to be substituted with stubs.</p>
<h1><a class="anchor" id="dr_003_c1"></a>
Comparison of Options</h1>
<ul>
<li><b>Option 0:</b> Testing individual units without additional build configuration files<ul>
<li>Pros:<ul>
<li>would enable keeping the test design as originally envisioned</li>
<li>errors in one unit would not affect other units</li>
</ul>
</li>
<li>Cons:<ul>
<li>currently <b>impossible</b> to implement</li>
</ul>
</li>
</ul>
</li>
<li><b>Option 1:</b> Testing individual units with filters defined in additional files<ul>
<li>Pros: same as Option 0</li>
<li>Cons:<ul>
<li>implementation is <b>effortful and more complex</b></li>
</ul>
</li>
</ul>
</li>
<li><b>Option 2:</b> Testing individual units by separating them into individual libraries<ul>
<li>Pros: same as Option 0</li>
<li>Cons:<ul>
<li>the structuring of the software into packages could not be represented by directories anymore</li>
</ul>
</li>
</ul>
</li>
<li><b>Option 3:</b> Testing integrated units<ul>
<li>Pros:<ul>
<li>fewer individual tests necessary</li>
<li>less prone to changes (of details irrelevant for the test scope)</li>
<li>fits better with the <b>Common Closure Principle</b>: Tests are defined outside of the libraries but in a <a href="https://docs.platformio.org/en/stable/projectconf/sections/platformio/options/directory/test_dir.html" title="documentation of `test_dir`">dedicated test directory</a>. This is required by the build management tool currently used (PlatformIO). <br  />
 Interfaces of some units may change for other reasons than changes to the application requirements. For example when interfaces within a layer or to lower level layers change due to refactoring. These changes would require to adjust the tests. This means that the change in one layer would lead to a change in the "global" test directory. This effectively violates Common Closure Principle.</li>
</ul>
</li>
<li>Cons:<ul>
<li>to cover the same amount of control paths within the software with the integrated tests as with testing individual units, integrated test may require more complex or additional test cases.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="dr_003_c2"></a>
Comparing Options 3a)-3c)</h2>
<ul>
<li><b>Option 3a):</b> Testing integrated units including all compatible dependencies<ul>
<li>Pros:<ul>
<li>highest test coverage of options 3a)-3c)</li>
</ul>
</li>
<li>Cons:<ul>
<li>requires stubs of the 3rd party dependencies incompatible with the test environment</li>
</ul>
</li>
</ul>
</li>
<li><b>Option 3b):</b> Testing integrated units including all compatible dependencies, excluding 3rd party adapters<ul>
<li>Pros:<ul>
<li>Does not depend on the interface of the 3rd party dependencies incompatible with the test environment.</li>
</ul>
</li>
<li>Cons:<ul>
<li>requires stubs of all 3rd party adapters</li>
</ul>
</li>
</ul>
</li>
<li><b>Option 3c):</b> Testing integrated units of the libraries each<ul>
<li>Pros:<ul>
<li>Does not depend on the interface of the 3rd party dependencies incompatible with the test environment.</li>
</ul>
</li>
<li>Cons:<ul>
<li>requires the highest amount of stubs from the options 3a)-3c)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="dr_003_decision"></a>
Decision &amp; Rationale</h1>
<p >What do we want to achieve with the tests? To check if the observable behavior of the overall software is as expected.</p>
<p >As long as libraries are not delivered separately, it is not necessary to test them individually.</p>
<p >After careful consideration, we've decided on:</p>
<blockquote class="doxtable">
<p >&zwj;<b>Option 3b):</b> Testing integrated units including all compatible dependencies, excluding 3rd party adapters </p>
</blockquote>
<p>This decision aligns with the test objective, aiming to achieve good software quality while avoiding excessive effort.</p>
<p >This design decision shall be regarded as a minimum requirement. Additional tests or stubbing may be defined at one's liberty.</p>
<h1><a class="anchor" id="dr_003_next"></a>
Next Steps</h1>
<p >To implement this decision:</p>
<ul>
<li>Future tests are only required for the application layer. Units from lower layers will be tested indirectly.</li>
<li>Future tests may test several units at once.</li>
<li>Legacy tests that require modification must be checked if they satisfy the new test design and modified or removed accordingly. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 11 2024 17:41:45 for Task Tracker by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
